import{_ as U}from"./@babel-57eb5ba4.js";import{r as u}from"./react-612f7b04.js";import{T as ze,R as Lt,O as $e,P as Be,a as xe,L as Ce,b as zt,c as Ft,U as Wt,s as ct,B as Ht,M as It,V as I,d as $t,S as Bt,C as Ut,W as Nt,e as Gt,f as qt,g as Vt,h as Xt,i as Yt,N as Zt,A as Kt,j as Jt,D as Qt,k as be,l as Ue,m as er,E as lt,n as tr,o as rr,p as nr,q as ae,r as or,t as ir,u as sr}from"./three-c5f58e70.js";import{u as ar}from"./react-use-measure-33846a54.js";import{F as cr,u as lr}from"./its-fine-e5aff5f0.js";import{R as ur,c as se}from"./react-reconciler-bad81c96.js";import{s as Ke}from"./scheduler-765c72db.js";import{c as fr}from"./react-dom-90e8ae2b.js";import{c as ut}from"./zustand-1f571bb2.js";import"./maath-7f41861e.js";import{D as dr,G as Ne,a as pr,M as Se,O as mr}from"./three-stdlib-221bba02.js";import{m as Ge}from"./react-merge-refs-239dbb3c.js";import{s as vr,p as hr,c as gr}from"./suspend-react-00b64780.js";var Je,Qe;const yr=(e,...t)=>t.reduce((r,i)=>r==null?void 0:r[i],e),ne="ColorManagement"in ze&&yr(ze,"ColorManagement")||null,ft=e=>e&&e.isOrthographicCamera,br=e=>e&&e.hasOwnProperty("current"),ve=typeof window<"u"&&((Je=window.document)!=null&&Je.createElement||((Qe=window.navigator)==null?void 0:Qe.product)==="ReactNative")?u.useLayoutEffect:u.useEffect;function dt(e){const t=u.useRef(e);return ve(()=>void(t.current=e),[e]),t}function wr({set:e}){return ve(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class pt extends u.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}pt.getDerivedStateFromError=()=>({error:!0});const mt="__default",et=new Map,_r=e=>e&&!!e.memoized&&!!e.changes;function vt(e){const t=typeof window<"u"?window.devicePixelRatio:1;return Array.isArray(e)?Math.min(Math.max(e[0],t),e[1]):e}const ue=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},A={obj:e=>e===Object(e)&&!A.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(A.str(e)||A.num(e))return e===t;const c=A.obj(e);if(c&&i==="reference")return e===t;const h=A.arr(e);if(h&&r==="reference")return e===t;if((h||c)&&e===t)return!0;let m;for(m in e)if(!(m in t))return!1;for(m in s?t:e)if(e[m]!==t[m])return!1;if(A.und(m)){if(h&&e.length===0&&t.length===0||c&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Er(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Mr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const r=e;return(t!=null&&t.primitive||!r.__r3f)&&(r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function Fe(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return r=i.reduce((c,h)=>c[h],e),{target:r,key:s}}else return{target:r,key:t}}const tt=/-\d+$/;function Oe(e,t,r){if(A.str(r)){if(tt.test(r)){const c=r.replace(tt,""),{target:h,key:m}=Fe(e,c);Array.isArray(h[m])||(h[m]=[])}const{target:i,key:s}=Fe(e,r);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=r(e,t)}function rt(e,t,r){var i,s;if(A.str(r)){const{target:c,key:h}=Fe(e,r),m=t.__r3f.previousAttach;m===void 0?delete c[h]:c[h]=m}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function ht(e,{children:t,key:r,ref:i,...s},{children:c,key:h,ref:m,...a}={},g=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},p=Object.entries(s),d=[];if(g){const E=Object.keys(a);for(let y=0;y<E.length;y++)s.hasOwnProperty(E[y])||p.unshift([E[y],mt+"remove"])}p.forEach(([E,y])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&E==="object"||A.equ(y,a[E]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(E))return d.push([E,y,!0,[]]);let f=[];E.includes("-")&&(f=E.split("-")),d.push([E,y,!1,f]);for(const b in s){const w=s[b];b.startsWith(`${E}-`)&&d.push([b,w,!1,b.split("-")])}});const v={...s};return o.memoizedProps&&o.memoizedProps.args&&(v.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(v.attach=o.memoizedProps.attach),{memoized:v,changes:d}}function Re(e,t){var r,i,s;const c=(r=e.__r3f)!=null?r:{},h=c.root,m=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:a,changes:g}=_r(t)?t:ht(e,t),n=c.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let p=0;p<g.length;p++){let[d,v,E,y]=g[p],l=e,f=l[d];if(y.length&&(f=y.reduce((b,w)=>b[w],e),!(f&&f.set))){const[b,...w]=y.reverse();l=w.reverse().reduce((_,P)=>_[P],e),d=b}if(v===mt+"remove")if(l.constructor){let b=et.get(l.constructor);b||(b=new l.constructor,et.set(l.constructor,b)),v=b[d]}else v=0;if(E)v?c.handlers[d]=v:delete c.handlers[d],c.eventCount=Object.keys(c.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Ce)){if(Array.isArray(v))f.fromArray?f.fromArray(v):f.set(...v);else if(f.copy&&v&&v.constructor&&f.constructor===v.constructor)f.copy(v);else if(v!==void 0){const b=f instanceof Jt;!b&&f.setScalar?f.setScalar(v):f instanceof Ce&&v instanceof Ce?f.mask=v.mask:f.set(v),!ne&&!m.linear&&b&&f.convertSRGBToLinear()}}else l[d]=v,!m.linear&&l[d]instanceof zt&&l[d].format===Ft&&l[d].type===Wt&&(l[d].encoding=ct);ie(e)}if(c.parent&&m.internal&&e.raycast&&n!==c.eventCount){const p=m.internal.interaction.indexOf(e);p>-1&&m.internal.interaction.splice(p,1),c.eventCount&&m.internal.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(s=e.__r3f)!=null&&s.parent&&We(e),e}function ie(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function We(e){e.onUpdate==null||e.onUpdate(e)}function Pr(e,t){e.manual||(ft(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function xr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function gt(e,t,r,i){const s=r.get(t);s&&(r.delete(t),r.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function Cr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(s)}),r.capturedMap.forEach((i,s)=>{gt(r.capturedMap,t,i,s)})}function Sr(e){function t(a){const{internal:g}=e.getState(),n=a.offsetX-g.initialClick[0],o=a.offsetY-g.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(a){return a.filter(g=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(a,g){const n=e.getState(),o=new Set,p=[],d=g?g(n.internal.interaction):n.internal.interaction;for(let l=0;l<d.length;l++){const f=ue(d[l]);f&&(f.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(a,n);function v(l){const f=ue(l);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var b;f.events.compute==null||f.events.compute(a,f,(b=f.previousRoot)==null?void 0:b.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(l,!0):[]}let E=d.flatMap(v).sort((l,f)=>{const b=ue(l.object),w=ue(f.object);return!b||!w?l.distance-f.distance:w.events.priority-b.events.priority||l.distance-f.distance}).filter(l=>{const f=we(l);return o.has(f)?!1:(o.add(f),!0)});n.events.filter&&(E=n.events.filter(E,n));for(const l of E){let f=l.object;for(;f;){var y;(y=f.__r3f)!=null&&y.eventCount&&p.push({...l,eventObject:f}),f=f.parent}}if("pointerId"in a&&n.internal.capturedMap.has(a.pointerId))for(let l of n.internal.capturedMap.get(a.pointerId).values())o.has(we(l.intersection))||p.push(l.intersection);return p}function s(a,g,n,o){const p=e.getState();if(a.length){const d={stopped:!1};for(const v of a){const E=ue(v.object)||p,{raycaster:y,pointer:l,camera:f,internal:b}=E,w=new I(l.x,l.y,0).unproject(f),_=x=>{var C,z;return(C=(z=b.capturedMap.get(x))==null?void 0:z.has(v.eventObject))!=null?C:!1},P=x=>{const C={intersection:v,target:g.target};b.capturedMap.has(x)?b.capturedMap.get(x).set(v.eventObject,C):b.capturedMap.set(x,new Map([[v.eventObject,C]])),g.target.setPointerCapture(x)},S=x=>{const C=b.capturedMap.get(x);C&&gt(b.capturedMap,v.eventObject,C,x)};let O={};for(let x in g){let C=g[x];typeof C!="function"&&(O[x]=C)}let M={...v,...O,pointer:l,intersections:a,stopped:d.stopped,delta:n,unprojectedPoint:w,ray:y.ray,camera:f,stopPropagation(){const x="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!x||x.has(v.eventObject))&&(M.stopped=d.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(C=>C.eventObject===v.eventObject))){const C=a.slice(0,a.indexOf(v));c([...C,v])}},target:{hasPointerCapture:_,setPointerCapture:P,releasePointerCapture:S},currentTarget:{hasPointerCapture:_,setPointerCapture:P,releasePointerCapture:S},nativeEvent:g};if(o(M),d.stopped===!0)break}}return a}function c(a){const{internal:g}=e.getState();for(const n of g.hovered.values())if(!a.length||!a.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const p=n.eventObject.__r3f,d=p==null?void 0:p.handlers;if(g.hovered.delete(we(n)),p!=null&&p.eventCount){const v={...n,intersections:a};d.onPointerOut==null||d.onPointerOut(v),d.onPointerLeave==null||d.onPointerLeave(v)}}}function h(a,g){for(let n=0;n<g.length;n++){const o=g[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(a)}}function m(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>c([]);case"onLostPointerCapture":return g=>{const{internal:n}=e.getState();"pointerId"in g&&n.capturedMap.has(g.pointerId)&&(n.capturedMap.delete(g.pointerId),c([]))}}return function(n){const{onPointerMissed:o,internal:p}=e.getState();p.lastEvent.current=n;const d=a==="onPointerMove",v=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",y=i(n,d?r:void 0),l=v?t(n):0;a==="onPointerDown"&&(p.initialClick=[n.offsetX,n.offsetY],p.initialHits=y.map(b=>b.eventObject)),v&&!y.length&&l<=2&&(h(n,p.interaction),o&&o(n)),d&&c(y);function f(b){const w=b.eventObject,_=w.__r3f,P=_==null?void 0:_.handlers;if(_!=null&&_.eventCount)if(d){if(P.onPointerOver||P.onPointerEnter||P.onPointerOut||P.onPointerLeave){const S=we(b),O=p.hovered.get(S);O?O.stopped&&b.stopPropagation():(p.hovered.set(S,b),P.onPointerOver==null||P.onPointerOver(b),P.onPointerEnter==null||P.onPointerEnter(b))}P.onPointerMove==null||P.onPointerMove(b)}else{const S=P[a];S?(!v||p.initialHits.includes(w))&&(h(n,p.interaction.filter(O=>!p.initialHits.includes(O))),S(b)):v&&p.initialHits.includes(w)&&h(n,p.interaction.filter(O=>!p.initialHits.includes(O)))}}s(y,n,l,f)}}return{handlePointer:m}}let He={},Or=e=>void(He={...He,...e});function Rr(e,t){function r(n,{args:o=[],attach:p,...d},v){let E=`${n[0].toUpperCase()}${n.slice(1)}`,y;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;y=oe(l,{type:n,root:v,attach:p,primitive:!0})}else{const l=He[E];if(!l)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=oe(new l(...o),{type:n,root:v,attach:p,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y instanceof Ht?y.__r3f.attach="geometry":y instanceof It&&(y.__r3f.attach="material")),E!=="inject"&&Re(y,d),y}function i(n,o){let p=!1;if(o){var d,v;(d=o.__r3f)!=null&&d.attach?Oe(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),p=!0),p||(v=n.__r3f)==null||v.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,We(o),ie(o)}}function s(n,o,p){let d=!1;if(o){var v,E;if((v=o.__r3f)!=null&&v.attach)Oe(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const y=n.children.filter(f=>f!==o),l=y.indexOf(p);n.children=[...y.slice(0,l),o,...y.slice(l)],d=!0}d||(E=n.__r3f)==null||E.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,We(o),ie(o)}}function c(n,o,p=!1){n&&[...n].forEach(d=>h(o,d,p))}function h(n,o,p){if(o){var d,v,E;if(o.__r3f&&(o.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(w=>w!==o)),(v=o.__r3f)!=null&&v.attach)rt(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var y;n.remove(o),(y=o.__r3f)!=null&&y.root&&Cr(o.__r3f.root,o)}const f=(E=o.__r3f)==null?void 0:E.primitive,b=p===void 0?o.dispose!==null&&!f:p;if(!f){var l;c((l=o.__r3f)==null?void 0:l.objects,o,b),c(o.children,o,b)}o.__r3f&&(delete o.__r3f.root,delete o.__r3f.objects,delete o.__r3f.handlers,delete o.__r3f.memoizedProps,f||delete o.__r3f),b&&o.dispose&&o.type!=="Scene"&&Ke.unstable_scheduleCallback(Ke.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),ie(n)}}function m(n,o,p,d){var v;const E=(v=n.__r3f)==null?void 0:v.parent;if(!E)return;const y=r(o,p,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(y,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(y,l)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||h(E,n),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(E,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=y,l.ref&&(typeof l.ref=="function"?l.ref(y):l.ref.current=y))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:ur({createInstance:r,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const p=n.getState().scene;p.__r3f&&(p.__r3f.root=n,i(p,o))},removeChildFromContainer:(n,o)=>{o&&h(n.getState().scene,o)},insertInContainerBefore:(n,o,p)=>{if(!o||!p)return;const d=n.getState().scene;d.__r3f&&s(d,o,p)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,p,d){if(n.__r3f.primitive&&d.object&&d.object!==n)return[!0];{const{args:v=[],children:E,...y}=d,{args:l=[],children:f,...b}=p;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((_,P)=>_!==l[P]))return[!0];const w=ht(n,y,b,!0);return w.changes.length?[!1,w]:null}},commitUpdate(n,[o,p],d,v,E,y){o?m(n,d,E,y):Re(n,p)},commitMount(n,o,p,d){var v;const E=(v=n.__r3f)!=null?v:{};n.raycast&&E.handlers&&E.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>oe(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:p,parent:d}=(o=n.__r3f)!=null?o:{};p&&d&&rt(d,n,p),n.isObject3D&&(n.visible=!1),ie(n)},unhideInstance(n,o){var p;const{attach:d,parent:v}=(p=n.__r3f)!=null?p:{};d&&v&&Oe(v,n,d),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),ie(n)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&A.fun(performance.now)?performance.now:A.fun(Date.now)?Date.now:()=>0,scheduleTimeout:A.fun(setTimeout)?setTimeout:void 0,cancelTimeout:A.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Re}}const yt=e=>!!(e!=null&&e.render),bt=u.createContext(null),jr=(e,t)=>{const r=ut((m,a)=>{const g=new I,n=new I,o=new I;function p(l=a().camera,f=n,b=a().size){const{width:w,height:_,top:P,left:S}=b,O=w/_;f instanceof I?o.copy(f):o.set(...f);const M=l.getWorldPosition(g).distanceTo(o);if(ft(l))return{width:w/l.zoom,height:_/l.zoom,top:P,left:S,factor:1,distance:M,aspect:O};{const x=l.fov*Math.PI/180,C=2*Math.tan(x/2)*M,z=C*(w/_);return{width:z,height:C,top:P,left:S,factor:w/z,distance:M,aspect:O}}}let d;const v=l=>m(f=>({performance:{...f.performance,current:l}})),E=new $t;return{set:m,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,invalidate:(l=1)=>e(a(),l),advance:(l,f)=>t(l,f,a()),legacy:!1,linear:!1,flat:!1,scene:oe(new Bt),controls:null,clock:new Ut,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=a();d&&clearTimeout(d),l.performance.current!==l.performance.min&&v(l.performance.min),d=setTimeout(()=>v(a().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:l=>m(f=>({...f,events:{...f.events,...l}})),setSize:(l,f,b,w,_)=>{const P=a().camera,S={width:l,height:f,top:w||0,left:_||0,updateStyle:b};m(O=>({size:S,viewport:{...O.viewport,...p(P,n,S)}}))},setDpr:l=>m(f=>{const b=vt(l);return{viewport:{...f.viewport,dpr:b,initialDpr:f.viewport.initialDpr||b}}}),setFrameloop:(l="always")=>{const f=a().clock;f.stop(),f.elapsedTime=0,l!=="never"&&(f.start(),f.elapsedTime=0),m(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:u.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,f,b)=>{const w=a().internal;return w.priority=w.priority+(f>0?1:0),w.subscribers.push({ref:l,priority:f,store:b}),w.subscribers=w.subscribers.sort((_,P)=>_.priority-P.priority),()=>{const _=a().internal;_!=null&&_.subscribers&&(_.priority=_.priority-(f>0?1:0),_.subscribers=_.subscribers.filter(P=>P.ref!==l))}}}}}),i=r.getState();let s=i.size,c=i.viewport.dpr,h=i.camera;return r.subscribe(()=>{const{camera:m,size:a,viewport:g,gl:n,set:o}=r.getState();if(a!==s||g.dpr!==c){var p;s=a,c=g.dpr,Pr(m,a),n.setPixelRatio(g.dpr);const d=(p=a.updateStyle)!=null?p:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(a.width,a.height,d)}m!==h&&(h=m,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(m)}})))}),r.subscribe(m=>e(m)),r};let _e,Ar=new Set,Tr=new Set,Dr=new Set;function je(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function fe(e,t){switch(e){case"before":return je(Ar,t);case"after":return je(Tr,t);case"tail":return je(Dr,t)}}let Ae,Te;function De(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Ae=t.internal.subscribers,_e=0;_e<Ae.length;_e++)Te=Ae[_e],Te.ref.current(Te.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function kr(e){let t=!1,r,i,s;function c(a){i=requestAnimationFrame(c),t=!0,r=0,fe("before",a);for(const n of e.values()){var g;s=n.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((g=s.gl.xr)!=null&&g.isPresenting)&&(r+=De(a,s))}if(fe("after",a),r===0)return fe("tail",a),t=!1,cancelAnimationFrame(i)}function h(a,g=1){var n;if(!a)return e.forEach(o=>h(o.store.getState()),g);(n=a.gl.xr)!=null&&n.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+g),t||(t=!0,requestAnimationFrame(c)))}function m(a,g=!0,n,o){if(g&&fe("before",a),n)De(a,n,o);else for(const p of e.values())De(a,p.store.getState());g&&fe("after",a)}return{loop:c,invalidate:h,advance:m}}function wt(){const e=u.useContext(bt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function H(e=r=>r,t){return wt()(e,t)}function he(e,t=0){const r=wt(),i=r.getState().internal.subscribe,s=dt(e);return ve(()=>i(s,t,r),[t,i,r]),null}function _t(e,t){return function(r,...i){const s=new r;return e&&e(s),Promise.all(i.map(c=>new Promise((h,m)=>s.load(c,a=>{a.scene&&Object.assign(a,Er(a.scene)),h(a)},t,a=>m(new Error(`Could not load ${c}: ${a.message})`))))))}}function V(e,t,r,i){const s=Array.isArray(t)?t:[t],c=vr(_t(r,i),[e,...s],{equal:A.equ});return Array.isArray(t)?c:c[0]}V.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return hr(_t(r),[e,...i])};V.clear=function(e,t){const r=Array.isArray(t)?t:[t];return gr([e,...r])};const ce=new Map,{invalidate:nt,advance:ot}=kr(ce),{reconciler:Me,applyProps:q}=Rr(ce,xr),de={objects:"shallow",strict:!1},Lr=(e,t)=>{const r=typeof e=="function"?e(t):e;return yt(r)?r:new Nt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function zr(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:i,top:s,left:c}=e.parentElement.getBoundingClientRect();return{width:r,height:i,top:s,left:c}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Fr(e){const t=ce.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,c=i||jr(nt,ot),h=r||Me.createContainer(c,se.ConcurrentRoot,null,!1,null,"",s,null);t||ce.set(e,{fiber:h,store:c});let m,a=!1;return{configure(g={}){let{gl:n,size:o,events:p,onCreated:d,shadows:v=!1,linear:E=!1,flat:y=!1,legacy:l=!1,orthographic:f=!1,frameloop:b="always",dpr:w=[1,2],performance:_,raycaster:P,camera:S,onPointerMissed:O}=g,M=c.getState(),x=M.gl;M.gl||M.set({gl:x=Lr(n,e)});let C=M.raycaster;C||M.set({raycaster:C=new Lt});const{params:z,...Q}=P||{};if(A.equ(Q,C,de)||q(C,{...Q}),A.equ(z,C.params,de)||q(C,{params:{...C.params,...z}}),!M.camera){const F=S instanceof Gt,D=F?S:f?new $e(0,0,0,0,.1,1e3):new Be(75,0,.1,1e3);F||(D.position.z=5,S&&q(D,S),S!=null&&S.rotation||D.lookAt(0,0,0)),M.set({camera:D})}if(!M.xr){const F=(R,B)=>{const L=c.getState();L.frameloop!=="never"&&ot(R,!0,L,B)},D=()=>{const R=c.getState();R.gl.xr.enabled=R.gl.xr.isPresenting,R.gl.xr.setAnimationLoop(R.gl.xr.isPresenting?F:null),R.gl.xr.isPresenting||nt(R)},$={connect(){const R=c.getState().gl;R.xr.addEventListener("sessionstart",D),R.xr.addEventListener("sessionend",D)},disconnect(){const R=c.getState().gl;R.xr.removeEventListener("sessionstart",D),R.xr.removeEventListener("sessionend",D)}};x.xr&&$.connect(),M.set({xr:$})}if(x.shadowMap){const F=x.shadowMap.enabled,D=x.shadowMap.type;if(x.shadowMap.enabled=!!v,A.boo(v))x.shadowMap.type=xe;else if(A.str(v)){var X;const $={basic:qt,percentage:Vt,soft:xe,variance:Xt};x.shadowMap.type=(X=$[v])!=null?X:xe}else A.obj(v)&&Object.assign(x.shadowMap,v);(F!==x.shadowMap.enabled||D!==x.shadowMap.type)&&(x.shadowMap.needsUpdate=!0)}ne&&("enabled"in ne?ne.enabled=!l:"legacyMode"in ne&&(ne.legacyMode=l));const k=E?Yt:ct,G=y?Zt:Kt;x.outputEncoding!==k&&(x.outputEncoding=k),x.toneMapping!==G&&(x.toneMapping=G),M.legacy!==l&&M.set(()=>({legacy:l})),M.linear!==E&&M.set(()=>({linear:E})),M.flat!==y&&M.set(()=>({flat:y})),n&&!A.fun(n)&&!yt(n)&&!A.equ(n,x,de)&&q(x,n),p&&!M.events.handlers&&M.set({events:p(c)});const T=zr(e,o);return A.equ(T,M.size,de)||M.setSize(T.width,T.height,T.updateStyle,T.top,T.left),w&&M.viewport.dpr!==vt(w)&&M.setDpr(w),M.frameloop!==b&&M.setFrameloop(b),M.onPointerMissed||M.set({onPointerMissed:O}),_&&!A.equ(_,M.performance,de)&&M.set(F=>({performance:{...F.performance,..._}})),m=d,a=!0,this},render(g){return a||this.configure(),Me.updateContainer(u.createElement(Wr,{store:c,children:g,onCreated:m,rootElement:e}),h,null,()=>{}),c},unmount(){Et(e)}}}function Wr({store:e,children:t,onCreated:r,rootElement:i}){return ve(()=>{const s=e.getState();s.set(c=>({internal:{...c.internal,active:!0}})),r&&r(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),u.createElement(bt.Provider,{value:e},t)}function Et(e,t){const r=ce.get(e),i=r==null?void 0:r.fiber;if(i){const s=r==null?void 0:r.store.getState();s&&(s.internal.active=!1),Me.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var c,h,m,a;s.events.disconnect==null||s.events.disconnect(),(c=s.gl)==null||(h=c.renderLists)==null||h.dispose==null||h.dispose(),(m=s.gl)==null||m.forceContextLoss==null||m.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),Mr(s),ce.delete(e),t&&t(e)}catch{}},500)})}}Me.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:u.version});const ke={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Hr(e){const{handlePointer:t}=Sr(e);return{priority:1,enabled:!0,compute(r,i,s){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ke).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:s}=e.getState();(r=s.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:r=>{var i;const{set:s,events:c}=e.getState();c.disconnect==null||c.disconnect(),s(h=>({events:{...h.events,connected:r}})),Object.entries((i=c.handlers)!=null?i:[]).forEach(([h,m])=>{const[a,g]=ke[h];r.addEventListener(a,m,{passive:g})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([c,h])=>{if(i&&i.connected instanceof HTMLElement){const[m]=ke[c];i.connected.removeEventListener(m,h)}}),r(c=>({events:{...c.events,connected:void 0}}))}}}}const Ir=u.forwardRef(function({children:t,fallback:r,resize:i,style:s,gl:c,events:h=Hr,eventSource:m,eventPrefix:a,shadows:g,linear:n,flat:o,legacy:p,orthographic:d,frameloop:v,dpr:E,performance:y,raycaster:l,camera:f,onPointerMissed:b,onCreated:w,..._},P){u.useMemo(()=>Or(ze),[]);const S=lr(),[O,M]=ar({scroll:!0,debounce:{scroll:50,resize:0},...i}),x=u.useRef(null),C=u.useRef(null),[z,Q]=u.useState(null);u.useImperativeHandle(P,()=>x.current);const X=dt(b),[k,G]=u.useState(!1),[T,F]=u.useState(!1);if(k)throw k;if(T)throw T;const D=u.useRef(null);M.width>0&&M.height>0&&z&&(D.current||(D.current=Fr(z)),D.current.configure({gl:c,events:h,shadows:g,linear:n,flat:o,legacy:p,orthographic:d,frameloop:v,dpr:E,performance:y,raycaster:l,camera:f,size:M,onPointerMissed:(...R)=>X.current==null?void 0:X.current(...R),onCreated:R=>{R.events.connect==null||R.events.connect(m?br(m)?m.current:m:C.current),a&&R.setEvents({compute:(B,L)=>{const ee=B[a+"X"],te=B[a+"Y"];L.pointer.set(ee/L.size.width*2-1,-(te/L.size.height)*2+1),L.raycaster.setFromCamera(L.pointer,L.camera)}}),w==null||w(R)}}),D.current.render(u.createElement(S,null,u.createElement(pt,{set:F},u.createElement(u.Suspense,{fallback:u.createElement(wr,{set:G})},t))))),ve(()=>{Q(x.current)},[]),u.useEffect(()=>{if(z)return()=>Et(z)},[z]);const $=m?"none":"auto";return u.createElement("div",U({ref:C,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:$,...s}},_),u.createElement("div",{ref:O,style:{width:"100%",height:"100%"}},u.createElement("canvas",{ref:x,style:{display:"block"}},r)))}),vn=u.forwardRef(function(t,r){return u.createElement(cr,null,u.createElement(Ir,U({},t,{ref:r})))}),ge=new I,qe=new I,$r=new I;function Br(e,t,r){const i=ge.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=r.width/2,c=r.height/2;return[i.x*s+s,-(i.y*c)+c]}function Ur(e,t){const r=ge.setFromMatrixPosition(e.matrixWorld),i=qe.setFromMatrixPosition(t.matrixWorld),s=r.sub(i),c=t.getWorldDirection($r);return s.angleTo(c)>Math.PI/2}function Nr(e,t,r,i){const s=ge.setFromMatrixPosition(e.matrixWorld),c=s.clone();c.project(t),r.setFromCamera(c,t);const h=r.intersectObjects(i,!0);if(h.length){const m=h[0].distance;return s.distanceTo(r.ray.origin)<m}return!0}function Gr(e,t){if(t instanceof $e)return t.zoom;if(t instanceof Be){const r=ge.setFromMatrixPosition(e.matrixWorld),i=qe.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,c=r.distanceTo(i);return 1/(2*Math.tan(s/2)*c)}else return 1}function qr(e,t,r){if(t instanceof Be||t instanceof $e){const i=ge.setFromMatrixPosition(e.matrixWorld),s=qe.setFromMatrixPosition(t.matrixWorld),c=i.distanceTo(s),h=(r[1]-r[0])/(t.far-t.near),m=r[1]-h*t.far;return Math.round(h*c+m)}}const Ie=e=>Math.abs(e)<1e-10?0:e;function Mt(e,t,r=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=Ie(t[s]*e.elements[s])+(s!==15?",":")");return r+i}const Vr=(e=>t=>Mt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Xr=(e=>(t,r)=>Mt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Yr(e){return e&&typeof e=="object"&&"current"in e}const hn=u.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:s,center:c,fullscreen:h,portal:m,distanceFactor:a,sprite:g=!1,transform:n=!1,occlude:o,onOcclude:p,castShadow:d,receiveShadow:v,material:E,geometry:y,zIndexRange:l=[16777271,0],calculatePosition:f=Br,as:b="div",wrapperClass:w,pointerEvents:_="auto",...P},S)=>{const{gl:O,camera:M,scene:x,size:C,raycaster:z,events:Q,viewport:X}=H(),[k]=u.useState(()=>document.createElement(b)),G=u.useRef(),T=u.useRef(null),F=u.useRef(0),D=u.useRef([0,0]),$=u.useRef(null),R=u.useRef(null),B=(m==null?void 0:m.current)||Q.connected||O.domElement.parentNode,L=u.useRef(null),ee=u.useRef(!1),te=u.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Yr(o[0]),[o]);u.useLayoutEffect(()=>{const W=O.domElement;o&&o==="blending"?(W.style.zIndex=`${Math.floor(l[0]/2)}`,W.style.position="absolute",W.style.pointerEvents="none"):(W.style.zIndex=null,W.style.position=null,W.style.pointerEvents=null)},[o]),u.useLayoutEffect(()=>{if(T.current){const W=G.current=fr(k);if(x.updateMatrixWorld(),n)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const j=f(T.current,M,C);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${j[0]}px,${j[1]}px,0);transform-origin:0 0;`}return B&&(s?B.prepend(k):B.appendChild(k)),()=>{B&&B.removeChild(k),W.unmount()}}},[B,n]),u.useLayoutEffect(()=>{w&&(k.className=w)},[w]);const Ve=u.useMemo(()=>n?{position:"absolute",top:0,left:0,width:C.width,height:C.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:c?"translate3d(-50%,-50%,0)":"none",...h&&{top:-C.height/2,left:-C.width/2,width:C.width,height:C.height},...r},[r,c,h,C,n]),St=u.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);u.useLayoutEffect(()=>{if(ee.current=!1,n){var W;(W=G.current)==null||W.render(u.createElement("div",{ref:$,style:Ve},u.createElement("div",{ref:R,style:St},u.createElement("div",{ref:S,className:i,style:r,children:e}))))}else{var j;(j=G.current)==null||j.render(u.createElement("div",{ref:S,style:Ve,className:i,children:e}))}});const re=u.useRef(!0);he(W=>{if(T.current){M.updateMatrixWorld(),T.current.updateWorldMatrix(!0,!1);const j=n?D.current:f(T.current,M,C);if(n||Math.abs(F.current-M.zoom)>t||Math.abs(D.current[0]-j[0])>t||Math.abs(D.current[1]-j[1])>t){const Y=Ur(T.current,M);let N=!1;te&&(o!=="blending"?N=[x]:Array.isArray(o)&&(N=o.map(Z=>Z.current)));const le=re.current;if(N){const Z=Nr(T.current,M,z,N);re.current=Z&&!Y}else re.current=!Y;le!==re.current&&(p?p(!re.current):k.style.display=re.current?"block":"none");const ye=Math.floor(l[0]/2),Ot=o?te?[l[0],ye]:[ye-1,0]:l;if(k.style.zIndex=`${qr(T.current,M,Ot)}`,n){const[Z,Ye]=[C.width/2,C.height/2],Pe=M.projectionMatrix.elements[5]*Ye,{isOrthographicCamera:Ze,top:Rt,left:jt,bottom:At,right:Tt}=M,Dt=Vr(M.matrixWorldInverse),kt=Ze?`scale(${Pe})translate(${Ie(-(Tt+jt)/2)}px,${Ie((Rt+At)/2)}px)`:`translateZ(${Pe}px)`;let K=T.current.matrixWorld;g&&(K=M.matrixWorldInverse.clone().transpose().copyPosition(K).scale(T.current.scale),K.elements[3]=K.elements[7]=K.elements[11]=0,K.elements[15]=1),k.style.width=C.width+"px",k.style.height=C.height+"px",k.style.perspective=Ze?"":`${Pe}px`,$.current&&R.current&&($.current.style.transform=`${kt}${Dt}translate(${Z}px,${Ye}px)`,R.current.style.transform=Xr(K,1/((a||10)/400)))}else{const Z=a===void 0?1:Gr(T.current,M)*a;k.style.transform=`translate3d(${j[0]}px,${j[1]}px,0) scale(${Z})`}D.current=j,F.current=M.zoom}}if(!te&&L.current&&!ee.current)if(n){if($.current){const j=$.current.children[0];if(j!=null&&j.clientWidth&&j!=null&&j.clientHeight){const{isOrthographicCamera:Y}=M;if(Y||y)P.scale&&(Array.isArray(P.scale)?P.scale instanceof I?L.current.scale.copy(P.scale.clone().divideScalar(1)):L.current.scale.set(1/P.scale[0],1/P.scale[1],1/P.scale[2]):L.current.scale.setScalar(1/P.scale));else{const N=(a||10)/400,le=j.clientWidth*N,ye=j.clientHeight*N;L.current.scale.set(le,ye,1)}ee.current=!0}}}else{const j=k.children[0];if(j!=null&&j.clientWidth&&j!=null&&j.clientHeight){const Y=1/X.factor,N=j.clientWidth*Y,le=j.clientHeight*Y;L.current.scale.set(N,le,1),ee.current=!0}L.current.lookAt(W.camera.position)}});const Xe=u.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return u.createElement("group",U({},P,{ref:T}),o&&!te&&u.createElement("mesh",{castShadow:d,receiveShadow:v,ref:L},y||u.createElement("planeGeometry",null),E||u.createElement("shaderMaterial",{side:Qt,vertexShader:Xe.vertexShader,fragmentShader:Xe.fragmentShader})))});let pe=0;const gn=ut(e=>(be.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-pe)/(i-pe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(r=>({errors:[...r.errors,t]})),be.onProgress=(t,r,i)=>{r===i&&(pe=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-pe)/(i-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),it=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Pt(e,t){const r=H(s=>s.gl),i=V(Ue,it(e)?Object.values(e):e);if(u.useLayoutEffect(()=>{t==null||t(i)},[t]),u.useEffect(()=>{(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),it(e)){const s=Object.keys(e),c={};return s.forEach(h=>Object.assign(c,{[h]:i[s.indexOf(h)]})),c}else return i}Pt.preload=e=>V.preload(Ue,e);Pt.clear=e=>V.clear(Ue,e);function Zr(e){return Array.isArray(e)}function Le(e=[0,0,0]){return Zr(e)?e:e instanceof I||e instanceof lt?[e.x,e.y,e.z]:[e,e,e]}function yn({debug:e,mesh:t,children:r,position:i,rotation:s,scale:c,...h}){const m=u.useRef(null),a=u.useRef(null);return u.useLayoutEffect(()=>{const g=(t==null?void 0:t.current)||m.current.parent,n=m.current;if(!(g instanceof er))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const o={position:new I,rotation:new lt,scale:new I(1,1,1)};if(g){q(o,{position:i,scale:c});const p=g.matrixWorld.clone();if(g.matrixWorld.identity(),!s||typeof s=="number"){const d=new tr;d.position.copy(o.position),d.lookAt(g.position),typeof s=="number"&&d.rotateZ(s),q(o,{rotation:d.rotation})}else q(o,{rotation:s});return n.geometry=new dr(g,o.position,o.rotation,o.scale),a.current&&q(a.current,o),g.matrixWorld=p,()=>{n.geometry.dispose()}}},[t,...Le(i),...Le(c),...Le(s)]),u.createElement("mesh",{ref:m},r||u.createElement("meshStandardMaterial",U({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},h)),e&&u.createElement("mesh",{ref:a},u.createElement("boxGeometry",null),u.createElement("meshNormalMaterial",{wireframe:!0}),u.createElement("axesHelper",null)))}let Ee=null;function xt(e,t,r){return i=>{r&&r(i),e&&(Ee||(Ee=new pr),Ee.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(Ee)),t&&i.setMeshoptDecoder(typeof Se=="function"?Se():Se)}}function Ct(e,t=!0,r=!0,i){return V(Ne,e,xt(t,r,i))}Ct.preload=(e,t=!0,r=!0,i)=>V.preload(Ne,e,xt(t,r,i));Ct.clear=e=>V.clear(Ne,e);const bn=u.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:s=!0,onChange:c,onStart:h,onEnd:m,...a},g)=>{const n=H(_=>_.invalidate),o=H(_=>_.camera),p=H(_=>_.gl),d=H(_=>_.events),v=H(_=>_.setEvents),E=H(_=>_.set),y=H(_=>_.get),l=H(_=>_.performance),f=t||o,b=i||d.connected||p.domElement,w=u.useMemo(()=>new mr(f),[f]);return he(()=>{w.enabled&&w.update()},-1),u.useEffect(()=>(w.connect(b),()=>void w.dispose()),[b,r,w,n]),u.useEffect(()=>{const _=O=>{n(),r&&l.regress(),c&&c(O)},P=O=>{h&&h(O)},S=O=>{m&&m(O)};return w.addEventListener("change",_),w.addEventListener("start",P),w.addEventListener("end",S),()=>{w.removeEventListener("start",P),w.removeEventListener("end",S),w.removeEventListener("change",_)}},[c,h,m,w,n,v]),u.useEffect(()=>{if(e){const _=y().controls;return E({controls:w}),()=>E({controls:_})}},[e,w]),u.createElement("primitive",U({ref:g,object:w,enableDamping:s},a))});class Kr extends rr{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:s}=i.capabilities;r.fragmentShader=r.fragmentShader.replace("#include <output_fragment>",`
        ${s?"#include <output_fragment>":`#extension GL_OES_standard_derivatives : enable
#include <output_fragment>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <encodings_fragment>
      `)}}}const wn=u.forwardRef((e,t)=>{const[r]=u.useState(()=>new Kr(null));return u.createElement("primitive",U({},e,{object:r,ref:t,attach:"material"}))}),_n=u.forwardRef(({children:e,speed:t=1,rotationIntensity:r=1,floatIntensity:i=1,floatingRange:s=[-.1,.1],...c},h)=>{const m=u.useRef(null),a=u.useRef(Math.random()*1e4);return he(g=>{var n,o;const p=a.current+g.clock.getElapsedTime();m.current.rotation.x=Math.cos(p/4*t)/8*r,m.current.rotation.y=Math.sin(p/4*t)/8*r,m.current.rotation.z=Math.sin(p/4*t)/20*r;let d=Math.sin(p/4*t)/10;d=nr.mapLinear(d,-.1,.1,(n=s==null?void 0:s[0])!==null&&n!==void 0?n:-.1,(o=s==null?void 0:s[1])!==null&&o!==void 0?o:.1),m.current.position.y=d*i}),u.createElement("group",c,u.createElement("group",{ref:Ge([m,h])},e))});let J,me;const Jr=u.createContext(null),st=new or,at=new I,Qr=u.forwardRef(({children:e,range:t,limit:r=1e3,...i},s)=>{const c=u.useRef(null),[h,m]=u.useState([]),[[a,g,n]]=u.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);u.useEffect(()=>{c.current.geometry.attributes.position.needsUpdate=!0}),he(()=>{for(c.current.updateMatrix(),c.current.updateMatrixWorld(),st.copy(c.current.matrixWorld).invert(),c.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,h.length),J=0;J<h.length;J++)me=h[J].current,me.getWorldPosition(at).applyMatrix4(st),at.toArray(a,J*3),c.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(g,J*3),c.current.geometry.attributes.color.needsUpdate=!0,n.set([me.size],J),c.current.geometry.attributes.size.needsUpdate=!0});const o=u.useMemo(()=>({getParent:()=>c,subscribe:p=>(m(d=>[...d,p]),()=>m(d=>d.filter(v=>v.current!==p.current)))}),[]);return u.createElement("points",U({userData:{instances:h},matrixAutoUpdate:!1,ref:Ge([s,c]),raycast:()=>null},i),u.createElement("bufferGeometry",null,u.createElement("bufferAttribute",{attach:"attributes-position",count:a.length/3,array:a,itemSize:3,usage:ae}),u.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:ae}),u.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ae})),u.createElement(Jr.Provider,{value:o},e))}),en=u.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:s=3,...c},h)=>{const m=u.useRef(null);return he(()=>{const a=m.current.geometry.attributes;a.position.needsUpdate=!0,r&&(a.color.needsUpdate=!0),i&&(a.size.needsUpdate=!0)}),u.createElement("points",U({ref:Ge([h,m])},c),u.createElement("bufferGeometry",null,u.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/s,array:t,itemSize:s,usage:ae}),r&&u.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/s,array:r,itemSize:3,usage:ae}),i&&u.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:ae})),e)}),En=u.forwardRef((e,t)=>e.positions instanceof Float32Array?u.createElement(en,U({},e,{ref:t})):u.createElement(Qr,U({},e,{ref:t})));function Mn({all:e,scene:t,camera:r}){const i=H(({gl:h})=>h),s=H(({camera:h})=>h),c=H(({scene:h})=>h);return u.useLayoutEffect(()=>{const h=[];e&&(t||c).traverse(g=>{g.visible===!1&&(h.push(g),g.visible=!0)}),i.compile(t||c,r||s);const m=new ir(128);new sr(.01,1e5,m).update(i,t||c),m.dispose(),h.forEach(g=>g.visible=!1)},[]),null}export{vn as C,yn as D,_n as F,hn as H,bn as O,Mn as P,Ct as a,Pt as b,he as c,En as d,wn as e,gn as u};
